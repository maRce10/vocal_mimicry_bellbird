table(cs$check.res)
cs <- check_sels(X = sels, path = "./data/raw/recordings/consolidated_files")
cs <- cs[cs$check.res %in% c("sound file not found", "OK"),]
table(cs$check.res)
cs <- check_sels(X = sels, path = "./data/raw/recordings/consolidated_files")
unique(cs$sound.files[cs$check.res != "OK"])
sf <- list.files("./data/processed/Selections", full.names = TRUE)
dat <- sapply(sf, function(x) read.table(x, sep = "\t"))
ncl <- sapply(dat, ncol)
names(ncl[ncl > 14])
sels1 <- imp_raven(path = "./data/processed/Selections", warbler.format = TRUE, files = basename(names(ncl[ncl < 14])), all.data = TRUE)
sels2 <- imp_raven(path = "./data/processed/Selections", warbler.format = TRUE, files = basename(names(ncl[ncl == 14])), all.data = TRUE)
sels2$Song <- ifelse(is.na(sels2$Song), sels2$Canto,
sels2$Song)
sels2$Song <- ifelse(is.na(sels2$Song), sels2$Soong,
sels2$Song)
sels2$Soong <- sels2$Canto <- NULL
sels1$Song <- NA
names(sels1)
names(sels2)
sels <- rbind(sels1, sels2)
sels$sound.files <- gsub("Nueva-grabacio?", "Nueva-grabaciÃ³", sels$sound.files, fixed = TRUE)
# cns_data <- consolidate(path = "./data/raw/recordings", parallel = 10)
cs <- check_sels(X = sels, path = "./data/raw/recordings/consolidated_files")
cs <- cs[cs$check.res %in% c("sound file not found", "OK"),]
table(cs$check.res)
unique(cs$sound.files[cs$check.res != "OK"])
sels <- sels[cs$check.res == "OK", ]
sels$`Model species`[grep("Procnias", sels$`Model species`)] <- "Procnias tricarunculatus"
sels$`Model species`[grep("glossus", sels$`Model species`)] <- "Pteroglossus torquatus"
sels$`Model species`[grep("Ramphastos", sels$`Model species`)] <- "Ramphastos sulfuratus"
sels$source <-sels$Recording
sels$source[grep("cal$", sels$source)] <- "mimetic_bellbird"
sels$source[sels$source == ""] <- "mimetic_bellbird"
sels$source[grep("Procnias", sels$source)] <- "Procnias tricarunculatus"
sels$source[grep("Ramphastos", sels$source)] <- "Ramphastos sulfuratus"
sels$`Model species`[sels$sound.files == "Grab2-4.7.2020.wav"] <- "Procnias tricarunculatus"
sels$source[sels$sound.files == "Grab2-4.7.2020.wav"] <-  "mimetic_bellbird"
sels$Vocalization[sels$sound.files == "Grab2-4.7.2020.wav"] <-  "babbling"
sels$Vocalization[grep("1|2|3", sels$Vocalization)] <-  ""
sels$Vocalization[grep("gres", sels$Vocalization)] <- "aggresive"
sels$Vocalization[grep("Talama", sels$Vocalization)] <- "Talamancan"
sels$Vocalization[sels$sound.files == "Procnias-tricarunculatus-476248.wav"] <-  "Monteverde"
sels$Vocalization[grep("Ptero", sels$Vocalization)] <- NA
sels$Song[sels$Vocalization %in% 1:3] <- sels$Vocalization[sels$Vocalization %in% 1:3]
sels$Vocalization[grep("abblin", sels$Vocalization)] <-  "babbling"
sels$Vocalization[grep("Pteroglossus", sels$source)] <- NA
sels$Vocalization[sels$Vocalization == "" & !is.na(sels$Vocalization)] <- sels$`Model species`[sels$Vocalization == "" & !is.na(sels$Vocalization)]
sels[sels$Vocalization == "" & !is.na(sels$Vocalization),]
table(sels$source)
table(sels$Vocalization)
table(sels$Vocalization, sels$source)
table(sels$`Model species`, sels$source)
# sels[grepl("mimetic", sels$source) & sels$`Model species` == "", ]
write.csv(sels, "./data/processed/pooled_annotations.csv", row.names = FALSE)
# write.csv(data.frame(missing = unique(cs$sound.files[cs$check.res != "OK"])), "./data/processed/missing_sound_files.csv", row.names = FALSE)
sels <- read.csv("./data/processed/pooled_annotations.csv")
cs <- check_sels(sels)
cs$check.res
sf <- list.files("./data/processed/Selections", full.names = TRUE)
dat <- sapply(sf, function(x) read.table(x, sep = "\t"))
ncl <- sapply(dat, ncol)
names(ncl[ncl > 14])
sels1 <- imp_raven(path = "./data/processed/Selections", warbler.format = TRUE, files = basename(names(ncl[ncl < 14])), all.data = TRUE)
sels2 <- imp_raven(path = "./data/processed/Selections", warbler.format = TRUE, files = basename(names(ncl[ncl == 14])), all.data = TRUE)
sels2$Song <- ifelse(is.na(sels2$Song), sels2$Canto,
sels2$Song)
sels2$Song <- ifelse(is.na(sels2$Song), sels2$Soong,
sels2$Song)
sels2$Soong <- sels2$Canto <- NULL
sels1$Song <- NA
names(sels1)
names(sels2)
sels <- rbind(sels1, sels2)
sels$sound.files <- gsub("Nueva-grabacio?", "Nueva-grabaciÃ³", sels$sound.files, fixed = TRUE)
# cns_data <- consolidate(path = "./data/raw/recordings", parallel = 10)
cs <- check_sels(X = sels, path = "./data/raw/recordings/consolidated_files")
# cs <- cs[cs$check.res %in% c("sound file not found", "OK"),]
#
# table(cs$check.res)
#
# unique(cs$sound.files[cs$check.res != "OK"])
sels <- sels[cs$check.res == "OK", ]
sels$`Model species`[grep("Procnias", sels$`Model species`)] <- "Procnias tricarunculatus"
sels$`Model species`[grep("glossus", sels$`Model species`)] <- "Pteroglossus torquatus"
sels$`Model species`[grep("Ramphastos", sels$`Model species`)] <- "Ramphastos sulfuratus"
sels$source <-sels$Recording
sels$source[grep("cal$", sels$source)] <- "mimetic_bellbird"
sels$source[sels$source == ""] <- "mimetic_bellbird"
sels$source[grep("Procnias", sels$source)] <- "Procnias tricarunculatus"
sels$source[grep("Ramphastos", sels$source)] <- "Ramphastos sulfuratus"
sels$`Model species`[sels$sound.files == "Grab2-4.7.2020.wav"] <- "Procnias tricarunculatus"
sels$source[sels$sound.files == "Grab2-4.7.2020.wav"] <-  "mimetic_bellbird"
sels$Vocalization[sels$sound.files == "Grab2-4.7.2020.wav"] <-  "babbling"
sels$Vocalization[grep("1|2|3", sels$Vocalization)] <-  ""
sels$Vocalization[grep("gres", sels$Vocalization)] <- "aggresive"
sels$Vocalization[grep("Talama", sels$Vocalization)] <- "Talamancan"
sels$Vocalization[sels$sound.files == "Procnias-tricarunculatus-476248.wav"] <-  "Monteverde"
sels$Vocalization[grep("Ptero", sels$Vocalization)] <- NA
sels$Song[sels$Vocalization %in% 1:3] <- sels$Vocalization[sels$Vocalization %in% 1:3]
sels$Vocalization[grep("abblin", sels$Vocalization)] <-  "babbling"
sels$Vocalization[grep("Pteroglossus", sels$source)] <- NA
sels$Vocalization[sels$Vocalization == "" & !is.na(sels$Vocalization)] <- sels$`Model species`[sels$Vocalization == "" & !is.na(sels$Vocalization)]
sels[sels$Vocalization == "" & !is.na(sels$Vocalization),]
table(sels$source)
table(sels$Vocalization)
table(sels$Vocalization, sels$source)
table(sels$`Model species`, sels$source)
# sels[grepl("mimetic", sels$source) & sels$`Model species` == "", ]
write.csv(sels, "./data/processed/pooled_annotations.csv", row.names = FALSE)
# write.csv(data.frame(missing = unique(cs$sound.files[cs$check.res != "OK"])), "./data/processed/missing_sound_files.csv", row.names = FALSE)
sels <- read.csv("./data/processed/pooled_annotations.csv")
cs <- check_sels(sels)
table(cs$check.res)
spectrograms(sels[1:100, ], fast.spec = TRUE, flim = c(0, 10), wl = 512, ovlp = 50, parallel = 10, dest.path = ".data/processed/spectrograms")
spectrograms(sels[1:100, ], fast.spec = TRUE, flim = c(0, 10), wl = 512, ovlp = 50, parallel = 10, dest.path = "./data/processed/spectrograms")
table(sels$Song)
spectrograms(sels[1:100, ], fast.spec = TRUE, flim = c(0, 10), wl = 512, ovlp = 50, parallel = 10, dest.path = "./data/processed/spectrograms", by.song = "Song")
spectrograms(sels[1:100, ], fast.spec = TRUE, flim = c(0, 10), wl = 512, ovlp = 50, parallel = 10, dest.path = "./data/processed/spectrograms", by.song = "Song")
spectrograms(sels, fast.spec = TRUE, flim = c(0, 10), wl = 512, ovlp = 50, parallel = 10, dest.path = "./data/processed/spectrograms")
head(sels)
## add 'developer/' to packages to be installed from github
x <- c("remotes", "maRce10/warbleR", "Rraven", "viridis", "ggplot2", "knitr", "kableExtra", "formatR", "ranger", "tuneRanger", "soundgen", "smacof", "caret")
aa <- lapply(x, function(y) {
# get pakage name
pkg <- strsplit(y, "/")[[1]]
pkg <- pkg[length(pkg)]
# check if installed, if not then install
if (!pkg %in% installed.packages()[,"Package"])  {
if (grepl("/", y))  remotes::install_github(y, force = TRUE) else
install.packages(y)
}
# load package
try(require(pkg, character.only = T), silent = T)
})
opts_knit$set(root.dir = "..")
extract_proximity_oob <- function(fit, olddata) {
pred = predict(fit, olddata, type = "terminalNodes")$predictions
prox = matrix(NA, nrow(pred), nrow(pred))
ntree = ncol(pred)
n = nrow(prox)
if (is.null(fit$inbag.counts)) {
stop("call ranger with keep.inbag = TRUE")
}
# Get inbag counts
inbag = simplify2array(fit$inbag.counts)
for (i in 1:n) {
for (j in 1:n) {
# Use only trees where both obs are OOB
tree_idx = inbag[i, ] == 0 & inbag[j, ] == 0
prox[i, j] = sum(pred[i, tree_idx] == pred[j, tree_idx]) / sum(tree_idx)
}
}
return(prox)
}
extract_proximity_oob <- function(fit, olddata) {
pred = predict(fit, olddata, type = "terminalNodes")$predictions
prox = matrix(NA, nrow(pred), nrow(pred))
ntree = ncol(pred)
n = nrow(prox)
if (is.null(fit$inbag.counts)) {
stop("call ranger with keep.inbag = TRUE")
}
# Get inbag counts
inbag = simplify2array(fit$inbag.counts)
for (i in 1:n) {
for (j in 1:n) {
# Use only trees where both obs are OOB
tree_idx = inbag[i, ] == 0 & inbag[j, ] == 0
prox[i, j] = sum(pred[i, tree_idx] == pred[j, tree_idx]) / sum(tree_idx)
}
}
return(prox)
}
attach(readRDS("./data/processed/random_forest_model_and_mds.RDS"))
getwd()
sp_param <- read.csv("acoustic_parameters_model_and_mimetic.csv")
model_sp_param <- sp_param[grep("mimetic", sp_param$species.vocalization, invert = TRUE), ]
# remove babbling due to low sample size (16)
model_sp_param <- model_sp_param[model_sp_param$species.vocalization != "P.tricarunculatus-babbling", ]
# tune random forest
rf_task <- makeClassifTask(data = model_sp_param[, -c(1, 2)], target = "species.vocalization")
# Estimate runtime
estimateTimeTuneRanger(rf_task)
# Tuning
tuning.results <- tuneRanger(rf_task, measure = list(multiclass.brier), num.trees = 10000, num.threads = 10, iters = 1000, save.file.path = NULL, show.info = FALSE)
# Model with the new tuned hyperparameters
rf <- ranger(as.factor(species.vocalization) ~ ., data = model_sp_param[, -c(1, 2)], num.trees = 10000, importance = "impurity", keep.inbag = TRUE, mtry = tuning.results$recommended.pars$mtry, min.node.size = tuning.results$recommended.pars$min.node.size, sample.fraction = tuning.results$recommended.pars$sample.fraction)
rf$prediction.error
prx.mat <- extract_proximity_oob(fit = rf, olddata = model_sp_param)
diss <- dist(t(prx.mat))   ## Euclidean distances
fit <- mds(diss, ndim = 2)        ## 2D interval MDS
set.seed(123)
rf.mds <- bootmds(fit, prx.mat, method.dat = "euclidean", nrep = 50)
saveRDS(list(rf = rf, rf.mds = rf.mds, labels =  model_sp_param$species.vocalization), "./data/processed/random_forest_model_and_mds.RDS")
attach(readRDS("./data/processed/random_forest_model_and_mds.RDS"))
mds.shp <- data.frame(species.vocalization = labels, rf.mds$conf, stringsAsFactors = FALSE)
ggplot(mds.shp, aes(x = D1, y = D2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
# scale_shape_manual(values = c(15, 19)) +
# scale_color_manual(values = viridis(10, alpha = 0.6)[c(4, 8)]) +
theme_classic() +
labs(x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.position = c(0.15, 0.9),  legend.text = element_text(face="italic"))
rf.mds.boot <- rf.mds
rf.mds <- cmdscale(prx.mat, k = 2)
rf.mds <- cmdscale(prx.mat, k = 2)
saveRDS(list(rf = rf, rf.mds.boot = rf.mds.boot, rf.mds = rf.mds, labels =  model_sp_param$species.vocalization), "./data/processed/random_forest_model_and_mds.RDS")
mds.shp.boot <- data.frame(species.vocalization = labels, rf.mds.boot$conf, stringsAsFactors = FALSE)
ggplot(mds.shp.boot, aes(x = D1, y = D2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
# scale_shape_manual(values = c(15, 19)) +
# scale_color_manual(values = viridis(10, alpha = 0.6)[c(4, 8)]) +
theme_classic() +
labs(x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.position = c(0.15, 0.9),  legend.text = element_text(face="italic"))
rf.mds
str(mds.shp.boot)
mds.shp <- data.frame(species.vocalization = labels, rf.mds, stringsAsFactors = FALSE)
ggplot(mds.shp, aes(x = D1, y = D2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
# scale_shape_manual(values = c(15, 19)) +
# scale_color_manual(values = viridis(10, alpha = 0.6)[c(4, 8)]) +
theme_classic() +
labs(x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.position = c(0.15, 0.9),  legend.text = element_text(face="italic"))
names(mds.shp)
ggplot(mds.shp, aes(x = X1, y = X2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
# scale_shape_manual(values = c(15, 19)) +
# scale_color_manual(values = viridis(10, alpha = 0.6)[c(4, 8)]) +
theme_classic() +
labs(x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.position = c(0.15, 0.9),  legend.text = element_text(face="italic"))
mimetic_sp_param <- sp_param[grep("mimetic", sp_param$species.vocalization), ]
mimetic_sp_param$pred.class <- as.character(predict(object = rf, data = mimetic_sp_param)$predictions)
table(mimetic_sp_param$pred.class)
table(mimetic_sp_param$species.vocalization)
table(mimetic_sp_param$pred.class, mimetic_sp_param$species.vocalization)
mimetic_no_calls <- mimetic_sp_param[!mimetic_sp_param$species.vocalization %in% c("mimetic_P.tricarunculatus-babbling", "mimetic_P.tricarunculatus-aggresive", "mimetic_P.tricarunculatus-whistle"), ]
mimetic_no_calls$pred.class[grep("tricarun", mimetic_no_calls$pred.class)] <- "P.tricarunculatus"
table(mimetic_no_calls$pred.class, mimetic_no_calls$species.vocalization)
mimetic_no_calls$pred.class[grep("montezuma", mimetic_no_calls$pred.class)] <- mimetic_no_calls$species.vocalization[grep("montezuma", mimetic_no_calls$species.vocalization)] <- "P.montezuma"
mimetic_no_calls$pred.class[grep("torquatus", mimetic_no_calls$pred.class)] <- mimetic_no_calls$species.vocalization[grep("torquatus", mimetic_no_calls$species.vocalization)] <- "P.torquatus"
mimetic_no_calls$pred.class[grep("sulfuratus", mimetic_no_calls$pred.class)] <- mimetic_no_calls$species.vocalization[grep("sulfuratus", mimetic_no_calls$species.vocalization)] <- "R.sulfuratus"
mimetic_no_calls$pred.class[grep("tricarunculatus", mimetic_no_calls$pred.class)] <- mimetic_no_calls$species.vocalization[grep("tricarunculatus", mimetic_no_calls$species.vocalization)] <- "P.tricarunculatus"
confusionMatrix(data = as.factor(mimetic_no_calls$pred.class), reference = as.factor(mimetic_no_calls$species.vocalization))
# remotes::install_github("rlesur/klippy")
# github packages must include user name ("user/package")
pkgs <- c("rlesur/klippy", "kableExtra", "knitr", "formatR")
# install/ load packages
out <- lapply(pkgs, function(y) {
# get pakage name
pkg <- strsplit(y, "/")[[1]]
pkg <- pkg[length(pkg)]
# check if installed, if not then install
if (!pkg %in% installed.packages()[,"Package"])  {
if (grepl("/", y))  remotes::install_github(y, force = TRUE) else
install.packages(y)
}
# load package
a <- try(require(pkg, character.only = T), silent = T)
if (!a) remove.packages(pkg)
})
table(mimetic_sp_param$pred.class)
table(mimetic_sp_param$species.vocalization)
table(mimetic_sp_param$pred.class, mimetic_sp_param$species.vocalization)
file.copy(file.path(R.home("doc"), "html", "logo.jpg"), '.')
getwd()
attach(readRDS("./data/processed/random_forest_model_and_mds.RDS"))
mds.shp.boot <- data.frame(species.vocalization = labels, rf.mds.boot$conf, stringsAsFactors = FALSE)
ggplot(mds.shp.boot, aes(x = D1, y = D2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
scale_color_viridis_d() +
theme_classic() +
labs(title = "Bootstrapped MDS", x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.position = c(0.15, 0.9),  legend.text = element_text(face="italic"))
mds.shp <- data.frame(species.vocalization = labels, rf.mds, stringsAsFactors = FALSE)
names(mds.shp)
ggplot(mds.shp, aes(x = X1, y = X2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
scale_color_viridis_d() +
theme_classic() +
labs(title = "Regular MDS", x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.text = element_text(face="italic"))
ggplot(mds.shp[mds.shp$X1 < 0.2, ], aes(x = X1, y = X2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
scale_color_viridis_d() +
theme_classic() +
labs(title = "Regular MDS", x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.text = element_text(face="italic"))
ggplot(mds.shp[mds.shp$X1 < 0.2 & mds.shp$X2 < 0.2, ], aes(x = X1, y = X2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
scale_color_viridis_d() +
theme_classic() +
labs(title = "Regular MDS", x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.text = element_text(face="italic"))
attach(readRDS("./data/processed/random_forest_model_and_mds.RDS"))
mds.shp.boot <- data.frame(species.vocalization = labels, rf.mds.boot$conf, stringsAsFactors = FALSE)
ggplot(mds.shp.boot, aes(x = D1, y = D2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
scale_color_viridis_d() +
theme_classic() +
labs(title = "Bootstrapped MDS", x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.text = element_text(face="italic"))
mds.shp <- data.frame(species.vocalization = labels, rf.mds, stringsAsFactors = FALSE)
names(mds.shp)
ggplot(mds.shp[mds.shp$X1 < 0.2 & mds.shp$X2 < 0.2, ], aes(x = X1, y = X2, color = species.vocalization, shape = species.vocalization)) +
geom_point(size = 7)+
scale_color_viridis_d() +
theme_classic() +
labs(title = "Regular MDS", x = "Dimension 1", y = "Dimension 2", color = "Leaf type", shape = "Leaf type") +
theme(text = element_text(size=20), legend.text = element_text(face="italic"))
vgg <- read.csv("./data/processed/turicreate_results_mimetic_many_dialects.csv")
vgg
conf_mat <- confusionMatrix(data = factor(vgg$pred), reference = factor(vgg$category))
# remotes::install_github("rlesur/klippy")
# github packages must include user name ("user/package")
pkgs <- c("rlesur/klippy", "kableExtra", "knitr", "remotes", "maRce10/warbleR", "Rraven", "viridis", "ggplot2", "formatR", "soundgen", "caret", "randomForest")
# install/ load packages
out <- lapply(pkgs, function(y) {
# get pakage name
pkg <- strsplit(y, "/")[[1]]
pkg <- pkg[length(pkg)]
# check if installed, if not then install
if (!pkg %in% installed.packages()[,"Package"])  {
if (grepl("/", y))  remotes::install_github(y, force = TRUE) else
install.packages(y)
}
# load package
a <- try(require(pkg, character.only = T), silent = T)
if (!a) remove.packages(pkg)
})
opts_knit$set(root.dir = "..")
knitr::opts_chunk$set(
tidy.opts = list(width.cutoff = 65),
tidy = TRUE,
message = FALSE,
warning = FALSE,
eval = FALSE
)
# this is a customized printing for data frames
# screws up tibble function
tibble <- function(x, ...) {
x <- kbl(x, digits=4, align= 'c', row.names = FALSE)
x <- kable_styling(x, position ="center", full_width = FALSE,  bootstrap_options = c("striped", "hover", "condensed", "responsive"))
asis_output(x)
}
registerS3method("knit_print", "data.frame", tibble)
# to add copy button to code blocks
klippy::klippy(position = c('top', 'right'))
conf_mat <- confusionMatrix(data = factor(vgg$pred), reference = factor(vgg$category))
unique(vgg$pred)
unique(vgg$category)
vgg$category <- factor(vgg$category, levels = c(unique(vgg$category), "P.tricarunculatus-Monteverde", "P.tricarunculatus-Nicaragua"))
vgg$category
unique(vgg$pred)
unique(vgg$category)
vgg$pred <- factor(vgg$category)
vgg <- read.csv("./data/processed/turicreate_results_mimetic_many_dialects.csv")
vgg$category <- factor(vgg$category, levels = c(unique(vgg$category), "P.tricarunculatus-Monteverde", "P.tricarunculatus-Nicaragua"))
vgg$pred <- factor(vgg$pred)
unique(vgg$pred)
unique(vgg$category)
vgg$category <- factor(vgg$category, levels = c(unique(vgg$category), "P.tricarunculatus-Monteverde", "P.tricarunculatus-Nicaragua", "P.tricarunculatus-Panama"))
vgg$pred <- factor(vgg$pred)
vgg <- read.csv("./data/processed/turicreate_results_mimetic_many_dialects.csv")
vgg$category <- factor(vgg$category, levels = c(unique(vgg$category), "P.tricarunculatus-Monteverde", "P.tricarunculatus-Nicaragua", "P.tricarunculatus-Panama"))
vgg$pred <- factor(vgg$pred)
unique(vgg$pred)
unique(vgg$category)
conf_mat <- confusionMatrix(data = factor(vgg$pred), reference = factor(vgg$category))
conf_mat <- confusionMatrix(data = vgg$pred, reference = vgg$category)
conf_mat
conf_df <- as.data.frame(conf_mat$table)
conf_df$total <- sapply(conf_df$Reference, function(x) sum(mimetic_no_calls$species.vocalization == x))
conf_df$total <- sapply(conf_df$Reference, function(x) sum(vgg$category == x))
conf_df$proportion <- conf_df$Freq / conf_df$total
ggplot(conf_df, aes(x = Reference, y = Prediction, fill = proportion)) +
geom_tile() + theme_bw() + coord_equal() +
scale_fill_distiller(palette="Greens", direction=1) +
geom_text(aes(label=round(proportion, 2)), color="black") +
labs(x = "Manually labeled category", y = "Predicted category") +
theme_classic() +
theme(axis.text.x=element_text(color = "black", size=11, angle=30, vjust=.8, hjust=0.8))
conf_df
conf_df <- conf_df[complete.cases(conf_df), ]
ggplot(conf_df, aes(x = Reference, y = Prediction, fill = proportion)) +
geom_tile() + theme_bw() + coord_equal() +
scale_fill_distiller(palette="Greens", direction=1) +
geom_text(aes(label=round(proportion, 2)), color="black") +
labs(x = "Manually labeled category", y = "Predicted category") +
theme_classic() +
theme(axis.text.x=element_text(color = "black", size=11, angle=30, vjust=.8, hjust=0.8))
library(warbleR)
bb_est <- readRDS("~/Dropbox/Projects/vggish_test/bellbird_data/extended_selection_table_high_snr_models_and_allmimetic_sounds.RDS")
bb_est
durs <- sapply(attr(bb_est, "wave.objects"), length)
mx_dur <- max(durs)
sfi <- info_sound_files("/home/m/Dropbox/estudiantes/Pablo_Huertas/vocal_mimicry_bellbird/data/raw/bellbird_data/audio")
sfi
summary(sfi)
table(sfi$samples)
bb_est$org.sound.files <- sapply(strsplit(bb_est$sound.files,
".wav", fixed = TRUE), "[", 1)
model_sounds <- as.data.frame(bb_est[grep("babbling", bb_est$species.vocalization,
invert = TRUE), ])
model_sounds$filename <- paste0(model_sounds$sound.files, ".wav")
model_sounds$species.vocalization <- gsub("-model", "", model_sounds$species.vocalization)
model_sounds <- model_sounds[grep("babbling", model_sounds$species.vocalization,
invert = TRUE), ]
mimetic_sounds <- model_sounds[grep("mimetic", model_sounds$species.vocalization), ]
mimetic_sounds$species.vocalization[grep("adult|aggresive|whistle", mimetic_sounds$species.vocalization)] <- "P.tricarunculatus-Talamanca"
mimetic_sounds$species.vocalization <- gsub(pattern = "mimetic_P.tricarunculatus-", "", mimetic_sounds$species.vocalization)
model_sounds <- model_sounds[grep("mimetic", model_sounds$species.vocalization, invert = TRUE), ]
aggregate(org.sound.files ~ species.vocalization, model_sounds, function(x) length(unique(x)))
set.seed(123)
part <- caret::createDataPartition(y = model_sounds$species.vocalization[model_sounds$species.vocalization != "Mimetic"], times = 1, p  = 0.75)
length(part$Resample1) / nrow(model_sounds)
model_sounds
table(model_sounds$species.vocalization)
aggregate(org.sound.files ~ species.vocalization, model_sounds, function(x) length(unique(x)))
model_sounds$category2 <- model_sounds$species.vocalization
model_sounds
table(model_sounds$species.vocalization)
model_sounds$category2[grep(model_sounds$category2, "P.tricarunculatus")]
model_sounds$category2[grep("P.tricarunculatus", model_sounds$category2)]
model_sounds$category2[grep("P.tricarunculatus", model_sounds$category2)] <- "P.tricarunculatus"
model_sounds$category2
mimetic_sounds$category2[grep("P.tricarunculatus", mimetic_sounds$category2)] <- "P.tricarunculatus"
mimetic_sounds$category2 <- mimetic_sounds$species.vocalization
mimetic_sounds$category2[grep("P.tricarunculatus", mimetic_sounds$category2)] <- "P.tricarunculatus"
model_sounds$categorynd[grep("P.tricarunculatus", model_sounds$category2)] <- "P.tricarunculatus"
model_sounds$categorynd <- model_sounds$species.vocalization
mimetic_sounds$categorynd <- mimetic_sounds$species.vocalization
model_sounds$categorynd[grep("P.tricarunculatus", model_sounds$category2)] <- "P.tricarunculatus"
model_sounds$categorynd <- model_sounds$species.vocalization
mimetic_sounds$categorynd <- mimetic_sounds$species.vocalization
model_sounds$categorynd[grep("P.tricarunculatus", model_sounds$categorynd)] <- "P.tricarunculatus"
mimetic_sounds$categorynd[grep("P.tricarunculatus", mimetic_sounds$categorynd)] <- "P.tricarunculatus"
model_sounds$categorynd
table(model_sounds$categorynd)
part <- caret::createDataPartition(y = model_sounds$categorynd, times = 1, p  = 0.75)
# collapsing dialects
set.seed(123)
partnd <- caret::createDataPartition(y = model_sounds$categorynd, times = 1, p  = 0.75)
length(partnd$Resample1) / nrow(model_sounds)
model_sounds$foldnd <- "test"
model_sounds$foldnd[part$Resample1] <- "train"
mimetic_sounds$foldnd <- "mimetic"
full_dat <- rbind(model_sounds, mimetic_sounds)
full_dat$category <- full_dat$species.vocalization
full_dat$target <- as.numeric(as.factor(full_dat$category))
table(full_dat$fold)
write.csv(full_dat[, c("filename", "fold", "category", "foldnd", "categorynd")], "/home/m/Dropbox/Projects/vggish_test/bellbird_data/bellbird.csv")
head(full_dat)
set.seed(123)
part <- caret::createDataPartition(y = model_sounds$species.vocalization[model_sounds$species.vocalization != "Mimetic"], times = 1, p  = 0.75)
length(part$Resample1) / nrow(model_sounds)
model_sounds$fold <- "test"
model_sounds$fold[part$Resample1] <- "train"
mimetic_sounds$fold <- "mimetic"
# collapsing dialects
set.seed(123)
partnd <- caret::createDataPartition(y = model_sounds$categorynd, times = 1, p  = 0.75)
length(partnd$Resample1) / nrow(model_sounds)
model_sounds$foldnd <- "test"
model_sounds$foldnd[part$Resample1] <- "train"
mimetic_sounds$foldnd <- "mimetic"
full_dat <- rbind(model_sounds, mimetic_sounds)
head(full_dat)
bb_est$org.sound.files <- sapply(strsplit(bb_est$sound.files,
".wav", fixed = TRUE), "[", 1)
model_sounds <- as.data.frame(bb_est[grep("babbling", bb_est$species.vocalization,
invert = TRUE), ])
model_sounds$filename <- paste0(model_sounds$sound.files, ".wav")
# model_sounds$species.vocalization[grep("mimetic", model_sounds$species.vocalization)] <- "Mimetic"
model_sounds$species.vocalization <- gsub("-model", "", model_sounds$species.vocalization)
model_sounds <- model_sounds[grep("babbling", model_sounds$species.vocalization,
invert = TRUE), ]
mimetic_sounds <- model_sounds[grep("mimetic", model_sounds$species.vocalization), ]
mimetic_sounds$species.vocalization[grep("adult|aggresive|whistle", mimetic_sounds$species.vocalization)] <- "P.tricarunculatus-Talamanca"
mimetic_sounds$species.vocalization <- gsub(pattern = "mimetic_P.tricarunculatus-", "", mimetic_sounds$species.vocalization)
model_sounds <- model_sounds[grep("mimetic", model_sounds$species.vocalization, invert = TRUE), ]
model_sounds$categorynd <- model_sounds$species.vocalization
mimetic_sounds$categorynd <- mimetic_sounds$species.vocalization
model_sounds$categorynd[grep("P.tricarunculatus", model_sounds$categorynd)] <- "P.tricarunculatus"
mimetic_sounds$categorynd[grep("P.tricarunculatus", mimetic_sounds$categorynd)] <- "P.tricarunculatus"
aggregate(org.sound.files ~ species.vocalization, model_sounds, function(x) length(unique(x)))
set.seed(123)
part <- caret::createDataPartition(y = model_sounds$species.vocalization[model_sounds$species.vocalization != "Mimetic"], times = 1, p  = 0.75)
length(part$Resample1) / nrow(model_sounds)
model_sounds$fold <- "test"
model_sounds$fold[part$Resample1] <- "train"
mimetic_sounds$fold <- "mimetic"
# collapsing dialects
set.seed(123)
partnd <- caret::createDataPartition(y = model_sounds$categorynd, times = 1, p  = 0.75)
length(partnd$Resample1) / nrow(model_sounds)
model_sounds$foldnd <- "test"
model_sounds$foldnd[part$Resample1] <- "train"
mimetic_sounds$foldnd <- "mimetic"
full_dat <- rbind(model_sounds, mimetic_sounds)
full_dat$category <- full_dat$species.vocalization
head(full_dat)
full_dat$category
write.csv(full_dat[, c("filename", "fold", "category", "foldnd", "categorynd")], "/home/m/Dropbox/Projects/vggish_test/bellbird_data/bellbird.csv")
nrow(full_dat)
table(full_dat$category[full_dat$fold == "mimetic"])
table(full_dat$categorynd[full_dat$foldnd == "mimetic"])
table(full_dat$category[full_dat$fold != "mimetic"])
table(full_dat$categorynd[full_dat$foldnd != "mimetic"])
